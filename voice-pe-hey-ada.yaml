# ─────────────────────────────────────────────────────────────
# Hey Ada — Voice PE Wake Word Config
# ─────────────────────────────────────────────────────────────
#
# Usage: In your ESPHome device YAML, replace the existing
# micro_wake_word: and select: sections with these.
#
# DO NOT use as a package — it will cause duplicate ID errors.
# Copy these sections into your main Voice PE config directly.
# ─────────────────────────────────────────────────────────────

micro_wake_word:
  id: mww
  microphone:
    microphone: i2s_mics
    channels: 1
    gain_factor: 4
  stop_after_detection: false
  models:
    - model: https://github.com/kahrendt/microWakeWord/releases/download/okay_nabu_20241226.3/okay_nabu.json
      id: okay_nabu
    - model: hey_jarvis
      id: hey_jarvis
    - model: hey_mycroft
      id: hey_mycroft
    - model: https://raw.githubusercontent.com/Kodeman/micro-wake-word-models/main/models/hey_ada/hey_ada.json
      id: hey_ada
    - model: https://github.com/kahrendt/microWakeWord/releases/download/stop/stop.json
      id: stop
      internal: true
  vad:
  on_wake_word_detected:
    - if:
        condition:
          switch.is_off: master_mute_switch
        then:
          - if:
              condition:
                switch.is_on: timer_ringing
              then:
                - switch.turn_off: timer_ringing
              else:
                - if:
                    condition:
                      voice_assistant.is_running:
                    then:
                      voice_assistant.stop:
                    else:
                      - if:
                          condition:
                            media_player.is_announcing:
                              id: external_media_player
                          then:
                            - media_player.stop:
                                announcement: true
                                id: external_media_player
                          else:
                            - if:
                                condition:
                                  switch.is_on: wake_sound
                                then:
                                  - script.execute:
                                      id: play_sound
                                      priority: true
                                      sound_file: "wake_word_triggered_sound"
                                  - delay: 300ms
                            - voice_assistant.start:
                                wake_word: !lambda return wake_word;

select:
  - platform: template
    name: "Wake word sensitivity"
    optimistic: true
    initial_option: Slightly sensitive
    restore_value: true
    entity_category: config
    options:
      - Slightly sensitive
      - Moderately sensitive
      - Very sensitive
    on_value:
      lambda: |-
        if (x == "Slightly sensitive") {
          id(okay_nabu).set_probability_cutoff(217);    // 0.85
          id(hey_jarvis).set_probability_cutoff(247);   // 0.97
          id(hey_mycroft).set_probability_cutoff(253);  // 0.99
          id(hey_ada).set_probability_cutoff(204);      // 0.80
        } else if (x == "Moderately sensitive") {
          id(okay_nabu).set_probability_cutoff(176);    // 0.69
          id(hey_jarvis).set_probability_cutoff(235);   // 0.92
          id(hey_mycroft).set_probability_cutoff(242);  // 0.95
          id(hey_ada).set_probability_cutoff(176);      // 0.69
        } else if (x == "Very sensitive") {
          id(okay_nabu).set_probability_cutoff(143);    // 0.56
          id(hey_jarvis).set_probability_cutoff(212);   // 0.83
          id(hey_mycroft).set_probability_cutoff(237);  // 0.93
          id(hey_ada).set_probability_cutoff(128);      // 0.50
        }
